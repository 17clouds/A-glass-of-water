!function(t){"use strict";if(!BX.PopupWindowManager){BX.PopupWindowManager={_popups:[],_currentPopup:null,create:function(t,e,o){var i;if(-1!==(i=this._getPopupIndex(t)))return this._popups[i];var n=new BX.PopupWindow(t,e,o);return BX.addCustomEvent(n,"onPopupShow",BX.delegate(this.onPopupShow,this)),BX.addCustomEvent(n,"onPopupClose",BX.delegate(this.onPopupClose,this)),n},onPopupWindowIsInitialized:function(t,e){BX.addCustomEvent(e,"onPopupDestroy",BX.delegate(this.onPopupDestroy,this)),this._popups.push(e)},onPopupShow:function(t){null!==this._currentPopup&&this._currentPopup.close(),this._currentPopup=t},onPopupClose:function(t){this._currentPopup=null},onPopupDestroy:function(t){var e;-1!==(e=this._getPopupIndex(t.uniquePopupId))&&(this._popups=BX.util.deleteFromArray(this._popups,e))},getCurrentPopup:function(){return this._currentPopup},isPopupExists:function(t){return-1!==this._getPopupIndex(t)},_getPopupIndex:function(t){for(var e=0;e<this._popups.length;e++)if(this._popups[e].uniquePopupId===t)return e;return-1},getMaxZIndex:function(){var t,e=0;for(t=0;t<this._popups.length;t++)e=Math.max(e,this._popups[t].params.zIndex);return e}},BX.addCustomEvent("onPopupWindowIsInitialized",BX.proxy(BX.PopupWindowManager.onPopupWindowIsInitialized,BX.PopupWindowManager)),BX.PopupWindow=function(e,o,i){if(i=i||{},this.params=i,BX.onCustomEvent("onPopupWindowInit",[e,o,i]),this.uniquePopupId=e,this.params.zIndex=parseInt(i.zIndex),this.params.zIndex=isNaN(i.zIndex)?0:i.zIndex,this.buttons=i.buttons&&BX.type.isArray(i.buttons)?i.buttons:[],this.offsetTop=BX.PopupWindow.getOption("offsetTop"),this.offsetLeft=BX.PopupWindow.getOption("offsetLeft"),this.firstShow=!1,this.bordersWidth=20,this.bindElementPos=null,this.closeIcon=null,this.resizeIcon=null,this.angle=null,this.overlay=null,this.titleBar=null,this.bindOptions="object"==typeof i.bindOptions?i.bindOptions:{},this.autoHide=!0===i.autoHide,this.isAutoHideBinded=!1,this.closeByEsc=!0===i.closeByEsc,this.isCloseByEscBinded=!1,this.width=null,this.height=null,this.minWidth=0,this.minHeight=0,i.parentPopup instanceof BX.PopupWindow?(this.parentPopup=i.parentPopup,this.appendContainer=i.parentPopup.contentContainer,i.offsetTop=(i.offsetTop?i.offsetTop:0)-(BX.PopupWindow.fullscreenStatus?0:this.parentPopup.popupContainer.offsetTop),i.offsetLeft=(i.offsetLeft?i.offsetLeft:0)-(BX.PopupWindow.fullscreenStatus?0:this.parentPopup.popupContainer.offsetLeft)):(this.parentPopup=null,this.appendContainer=document.body),this.dragOptions={cursor:"",callback:BX.DoNothing,eventName:""},this.dragged=!1,this.dragPageX=0,this.dragPageY=0,i.events)for(var n in i.events)BX.addCustomEvent(this,n,i.events[n]);var s="popup-window";i.contentColor&&BX.type.isNotEmptyString(i.contentColor)&&(s+=" popup-window-content-"+i.contentColor),i.contentNoPaddings&&(s+=" popup-window-content-no-paddings"),i.noAllPaddings&&(s+=" popup-window-no-paddings"),i.titleBar&&(s+=" popup-window-with-titlebar"),i.className&&BX.type.isNotEmptyString(i.className)&&(s+=" "+i.className),i.darkMode&&(s+=" popup-window-dark"),this.popupContainer=document.createElement("div");var p="popup-window-titlebar-"+e;i.titleBar&&(this.titleBar=BX.create("div",{props:{className:"popup-window-titlebar",id:p}})),i.closeIcon&&(this.closeIcon=BX.create("span",{props:{className:"popup-window-close-icon"+(i.titleBar?" popup-window-titlebar-close-icon":"")},style:"object"==typeof i.closeIcon?i.closeIcon:{},events:{click:BX.proxy(this._onCloseIconClick,this)}}),BX.browser.IsIE()&&BX.adjust(this.closeIcon,{attrs:{hidefocus:"true"}})),this.contentContainer=BX.create("div",{props:{id:"popup-window-content-"+e,className:"popup-window-content"}}),BX.adjust(this.popupContainer,{props:{id:e,className:s},style:{zIndex:this.getZindex(),position:"absolute",display:"none",top:"0px",left:"0px"},children:[this.titleBar,this.contentContainer,this.closeIcon]}),this.appendContainer.appendChild(this.popupContainer),this.buttonsContainer=null,i.angle&&this.setAngle(i.angle),i.overlay&&this.setOverlay(i.overlay),this.setOffset(i),this.setBindElement(o),this.setTitleBar(i.titleBar),this.setContent(i.content),this.setButtons(i.buttons),this.setWidth(i.width),this.setHeight(i.height),this.setResizeMode(i.resizable),!1!==i.bindOnResize&&BX.bind(t,"resize",BX.proxy(this._onResizeWindow,this)),BX.onCustomEvent("onPopupWindowIsInitialized",[e,this])},BX.PopupWindow.prototype.setContent=function(t){this.contentContainer&&t&&(BX.type.isElementNode(t)?(BX.cleanNode(this.contentContainer),this.contentContainer.appendChild(t.parentNode?t.parentNode.removeChild(t):t),t.style.display="block"):BX.type.isString(t)?this.contentContainer.innerHTML=t:this.contentContainer.innerHTML="&nbsp;")},BX.PopupWindow.prototype.setButtons=function(t){if(this.buttons=t&&BX.type.isArray(t)?t:[],this.buttonsContainer&&BX.remove(this.buttonsContainer),this.buttons.length>0&&this.contentContainer){for(var e=[],o=0;o<this.buttons.length;o++){var i=this.buttons[o];null!==i&&BX.is_subclass_of(i,BX.PopupWindowButton)&&(i.popupWindow=this,e.push(i.render()))}this.buttonsContainer=this.contentContainer.parentNode.appendChild(BX.create("div",{props:{className:"popup-window-buttons"},children:e}))}},BX.PopupWindow.prototype.getButtons=function(){return this.buttons},BX.PopupWindow.prototype.getButton=function(t){for(var e=0;e<this.buttons.length;e++){var o=this.buttons[e];if(o.getId()===t)return o}return null},BX.PopupWindow.prototype.setBindElement=function(t){t&&"object"==typeof t&&(BX.type.isDomNode(t)||BX.type.isNumber(t.top)&&BX.type.isNumber(t.left)?this.bindElement=t:BX.type.isNumber(t.clientX)&&BX.type.isNumber(t.clientY)&&(BX.fixEventPageXY(t),this.bindElement={left:t.pageX,top:t.pageY,bottom:t.pageY}))},BX.PopupWindow.prototype.getBindElementPos=function(t){if(BX.type.isDomNode(t))return BX.pos(t,!1);if(t&&"object"==typeof t)return BX.type.isNumber(t.bottom)||(t.bottom=t.top),t;var e=BX.GetWindowInnerSize(),o=BX.GetWindowScrollPos(),i=this.popupContainer.offsetWidth,n=this.popupContainer.offsetHeight;return this.bindOptions.forceTop=!0,{left:e.innerWidth/2-i/2+o.scrollLeft,top:e.innerHeight/2-n/2+o.scrollTop,bottom:e.innerHeight/2-n/2+o.scrollTop,windowSize:e,windowScroll:o,popupWidth:i,popupHeight:n}},BX.PopupWindow.prototype.setAngle=function(t){if(!1===t&&null!==this.angle)return BX.remove(this.angle.element),void(this.angle=null);var e="popup-window-angly";if(null===this.angle){var o=this.bindOptions.position&&"top"===this.bindOptions.position?"bottom":"top",i=BX.PopupWindow.getOption("top"===o?"angleMinTop":"angleMinBottom"),n=BX.type.isNumber(t.offset)?t.offset:0,s=BX.PopupWindow.getOption("angleLeftOffset",null);n>0&&BX.type.isNumber(s)&&(n+=s-BX.PopupWindow.defaultOptions.angleLeftOffset),this.angle={element:BX.create("div",{props:{className:e+" "+e+"-"+o}}),position:o,offset:0,defaultOffset:Math.max(n,i)},this.popupContainer.appendChild(this.angle.element)}if("object"==typeof t&&t.position&&BX.util.in_array(t.position,["top","right","bottom","left","hide"])&&(BX.removeClass(this.angle.element,e+"-"+this.angle.position),BX.addClass(this.angle.element,e+"-"+t.position),this.angle.position=t.position),"object"==typeof t&&BX.type.isNumber(t.offset)){var p,u,h=t.offset;"top"===this.angle.position?(p=BX.PopupWindow.getOption("angleMinTop"),u=(u=this.popupContainer.offsetWidth-BX.PopupWindow.getOption("angleMaxTop"))<p?Math.max(p,h):u,this.angle.offset=Math.min(Math.max(p,h),u),this.angle.element.style.left=this.angle.offset+"px",this.angle.element.style.marginLeft=0):"bottom"===this.angle.position?(p=BX.PopupWindow.getOption("angleMinBottom"),u=(u=this.popupContainer.offsetWidth-BX.PopupWindow.getOption("angleMaxBottom"))<p?Math.max(p,h):u,this.angle.offset=Math.min(Math.max(p,h),u),this.angle.element.style.marginLeft=this.angle.offset+"px",this.angle.element.style.left=0):"right"===this.angle.position?(p=BX.PopupWindow.getOption("angleMinRight"),u=(u=this.popupContainer.offsetHeight-BX.PopupWindow.getOption("angleMaxRight"))<p?Math.max(p,h):u,this.angle.offset=Math.min(Math.max(p,h),u),this.angle.element.style.top=this.angle.offset+"px"):"left"===this.angle.position&&(p=BX.PopupWindow.getOption("angleMinLeft"),u=(u=this.popupContainer.offsetHeight-BX.PopupWindow.getOption("angleMaxLeft"))<p?Math.max(p,h):u,this.angle.offset=Math.min(Math.max(p,h),u),this.angle.element.style.top=this.angle.offset+"px")}},BX.PopupWindow.prototype.setWidth=function(t){BX.type.isNumber(t)&&t>=0?(this.width=t,this.contentContainer.style.width=t+"px",this.contentContainer.style.overflowX="auto",this.titleBar&&(this.titleBar.style.width=t+"px")):!1===t&&(this.width=null,this.contentContainer.style.removeProperty("width"),this.contentContainer.style.removeProperty("overflowX"),this.titleBar&&this.titleBar.style.removeProperty("width"))},BX.PopupWindow.prototype.setHeight=function(t){BX.type.isNumber(t)&&t>=0?(this.height=t,this.contentContainer.style.height=t+"px",this.contentContainer.style.overflowY="auto"):!1===t&&(this.height=null,this.contentContainer.style.removeProperty("height"),this.contentContainer.style.removeProperty("overflowY"))},BX.PopupWindow.prototype.setResizeMode=function(t){!0===t||BX.type.isPlainObject(t)?(this.resizeIcon||(this.resizeIcon=BX.create("div",{props:{className:"popup-window-resize"},events:{mousedown:BX.proxy(this.onResizeMouseDown,this)}}),this.popupContainer.appendChild(this.resizeIcon)),BX.type.isNumber(t.minWidth)&&t.minWidth>0&&(this.minWidth=t.minWidth),BX.type.isNumber(t.minHeight)&&t.minHeight>0&&(this.minHeight=t.minHeight)):!1===t&&this.resizeIcon&&(BX.remove(this.resizeIcon),this.resizeIcon=null)},BX.PopupWindow.prototype.getWidth=function(){return this.width},BX.PopupWindow.prototype.getHeight=function(){return this.height},BX.PopupWindow.prototype.onTitleMouseDown=function(t){this._startDrag(t,{cursor:"move",callback:BX.proxy(this.move,this),eventName:"Drag"})},BX.PopupWindow.prototype.onResizeMouseDown=function(t){this._startDrag(t,{cursor:"nwse-resize",eventName:"Resize",callback:BX.proxy(this._resize,this)}),this.resizeContentPos=BX.pos(this.contentContainer),this.resizeContentOffset=this.resizeContentPos.left-BX.pos(this.popupContainer).left},BX.PopupWindow.prototype._resize=function(t,e,o,i){var n=o-this.resizeContentPos.left,s=i-this.resizeContentPos.top,p=BX.GetWindowScrollSize().scrollWidth;this.resizeContentPos.left+n+this.resizeContentOffset>=p&&(n=p-this.resizeContentPos.left-this.resizeContentOffset),this.setWidth(Math.max(n,this.minWidth)),this.setHeight(Math.max(s,this.minHeight))},BX.PopupWindow.prototype.isTopAngle=function(){return null!==this.angle&&"top"===this.angle.position},BX.PopupWindow.prototype.isBottomAngle=function(){return null!==this.angle&&"bottom"===this.angle.position},BX.PopupWindow.prototype.isTopOrBottomAngle=function(){return null!==this.angle&&BX.util.in_array(this.angle.position,["top","bottom"])},BX.PopupWindow.prototype.getAngleHeight=function(){return this.isTopOrBottomAngle()?BX.PopupWindow.getOption("angleTopOffset"):0},BX.PopupWindow.prototype.setOffset=function(t){BX.type.isPlainObject(t)&&(t.offsetLeft&&BX.type.isNumber(t.offsetLeft)&&(this.offsetLeft=t.offsetLeft+BX.PopupWindow.getOption("offsetLeft")),t.offsetTop&&BX.type.isNumber(t.offsetTop)&&(this.offsetTop=t.offsetTop+BX.PopupWindow.getOption("offsetTop")))},BX.PopupWindow.prototype.setTitleBar=function(t){this.titleBar&&("object"==typeof t&&BX.type.isDomNode(t.content)?(this.titleBar.innerHTML="",this.titleBar.appendChild(t.content)):"string"==typeof t&&(this.titleBar.innerHTML="",this.titleBar.appendChild(BX.create("span",{props:{className:"popup-window-titlebar-text"},text:t}))),this.params.draggable&&(this.titleBar.style.cursor="move",BX.bind(this.titleBar,"mousedown",BX.proxy(this.onTitleMouseDown,this))))},BX.PopupWindow.prototype.setClosingByEsc=function(t){(t=!BX.type.isBoolean(t)||t)?(this.closeByEsc=!0,this.isCloseByEscBinded||(BX.bind(document,"keyup",BX.proxy(this._onKeyUp,this)),this.isCloseByEscBinded=!0)):(this.closeByEsc=!1,this.isCloseByEscBinded&&(BX.unbind(document,"keyup",BX.proxy(this._onKeyUp,this)),this.isCloseByEscBinded=!1))},BX.PopupWindow.prototype.setAutoHide=function(t){(t=!BX.type.isBoolean(t)||t)?(this.autoHide=!0,this.isShown()&&this.bindAutoHide()):(this.autoHide=!1,this.unbindAutoHide())},BX.PopupWindow.prototype.bindAutoHide=function(){this.isAutoHideBinded||(this.isAutoHideBinded=!0,BX.bind(this.popupContainer,"click",this.cancelBubble),this.overlay&&this.overlay.element?BX.bind(this.overlay.element,"click",BX.proxy(this.close,this)):BX.bind(document,"click",BX.proxy(this.close,this)))},BX.PopupWindow.prototype.unbindAutoHide=function(){this.isAutoHideBinded&&(this.isAutoHideBinded=!1,BX.unbind(this.popupContainer,"click",this.cancelBubble),this.overlay&&this.overlay.element?BX.unbind(this.overlay.element,"click",BX.proxy(this.close,this)):BX.unbind(document,"click",BX.proxy(this.close,this)))},BX.PopupWindow.prototype.setOverlay=function(t){null===this.overlay&&(this.overlay={element:BX.create("div",{props:{className:"popup-window-overlay",id:"popup-window-overlay-"+this.uniquePopupId}})},this.adjustOverlayZindex(),this.resizeOverlay(),this.appendContainer.appendChild(this.overlay.element)),t&&t.hasOwnProperty("opacity")&&BX.type.isNumber(t.opacity)&&t.opacity>=0&&t.opacity<=100&&(BX.browser.IsIE()&&!BX.browser.IsIE9()?this.overlay.element.style.filter="alpha(opacity="+t.opacity+")":(this.overlay.element.style.filter="none",this.overlay.element.style.opacity=parseFloat(t.opacity/100).toPrecision(3))),t&&t.backgroundColor&&(this.overlay.element.style.backgroundColor=t.backgroundColor)},BX.PopupWindow.prototype.removeOverlay=function(){null!==this.overlay&&null!==this.overlay.element&&BX.remove(this.overlay.element),this.overlayTimeout&&(clearInterval(this.overlayTimeout),this.overlayTimeout=null),this.overlay=null},BX.PopupWindow.prototype.hideOverlay=function(){null!==this.overlay&&null!==this.overlay.element&&(this.overlayTimeout&&(clearInterval(this.overlayTimeout),this.overlayTimeout=null),this.overlay.element.style.display="none")},BX.PopupWindow.prototype.showOverlay=function(){if(null!==this.overlay&&null!==this.overlay.element){this.overlay.element.style.display="block";var t=this.popupContainer.offsetHeight;this.overlayTimeout=setInterval(function(){t!==this.popupContainer.offsetHeight&&(this.resizeOverlay(),t=this.popupContainer.offsetHeight)}.bind(this),1e3)}},BX.PopupWindow.prototype.resizeOverlay=function(){if(null!==this.overlay&&null!==this.overlay.element)if(this.parentPopup)this.overlay.element.style.width=this.parentPopup.popupContainer.offsetWidth+"px",this.overlay.element.style.height=this.parentPopup.popupContainer.offsetHeight+"px";else{var t=BX.GetWindowScrollSize(),e=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight);this.overlay.element.style.width=t.scrollWidth+"px",this.overlay.element.style.height=e+"px"}},BX.PopupWindow.prototype.getZindex=function(){return null!==this.overlay?BX.PopupWindow.getOption("popupOverlayZindex")+this.params.zIndex:BX.PopupWindow.getOption("popupZindex")+this.params.zIndex},BX.PopupWindow.prototype.adjustOverlayZindex=function(){null!==this.overlay&&null!==this.overlay.element&&(this.overlay.element.style.zIndex=parseInt(this.popupContainer.style.zIndex)-1)},BX.PopupWindow.prototype.show=function(){this.firstShow||(BX.onCustomEvent(this,"onPopupFirstShow",[this]),this.firstShow=!0),BX.onCustomEvent(this,"onPopupShow",[this]),this.showOverlay(),this.popupContainer.style.display="block",this.adjustPosition(),BX.onCustomEvent(this,"onAfterPopupShow",[this]),this.closeByEsc&&!this.isCloseByEscBinded&&(BX.bind(document,"keyup",BX.proxy(this._onKeyUp,this)),this.isCloseByEscBinded=!0),this.autoHide&&!this.isAutoHideBinded&&setTimeout(BX.proxy((function(){this.isShown()&&this.bindAutoHide()}),this),100)},BX.PopupWindow.prototype.isShown=function(){return"block"===this.popupContainer.style.display},BX.PopupWindow.prototype.cancelBubble=function(e){(e=e||t.event).stopPropagation?e.stopPropagation():e.cancelBubble=!0},BX.PopupWindow.prototype.close=function(t){if(this.isShown()){if(t&&!(BX.getEventButton(t)&BX.MSLEFT))return!0;BX.onCustomEvent(this,"onPopupClose",[this,t]),this.hideOverlay(),this.popupContainer.style.display="none",this.isCloseByEscBinded&&(BX.unbind(document,"keyup",BX.proxy(this._onKeyUp,this)),this.isCloseByEscBinded=!1),setTimeout(BX.proxy(this._close,this),0)}},BX.PopupWindow.prototype._close=function(){this.autoHide&&this.unbindAutoHide()},BX.PopupWindow.prototype._onCloseIconClick=function(e){e=e||t.event,this.close(e),BX.PreventDefault(e)},BX.PopupWindow.prototype._onKeyUp=function(e){27===(e=e||t.event).keyCode&&i(this.getZindex(),BX.proxy(this.close,this))},BX.PopupWindow.prototype.destroy=function(){BX.onCustomEvent(this,"onPopupDestroy",[this]),BX.unbindAll(this),BX.unbind(document,"keyup",BX.proxy(this._onKeyUp,this)),BX.unbind(document,"click",BX.proxy(this.close,this)),BX.unbind(document,"mousemove",BX.proxy(this._moveDrag,this)),BX.unbind(document,"mouseup",BX.proxy(this._stopDrag,this)),BX.unbind(t,"resize",BX.proxy(this._onResizeWindow,this)),BX.remove(this.popupContainer),this.removeOverlay()},BX.PopupWindow.prototype.enterFullScreen=function(){BX.PopupWindow.fullscreenStatus?document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():BX.browser.IsChrome()||BX.browser.IsSafari()?(this.contentContainer.webkitRequestFullScreen(this.contentContainer.ALLOW_KEYBOARD_INPUT),BX.bind(t,"webkitfullscreenchange",this.fullscreenBind=BX.proxy(this.eventFullScreen,this))):BX.browser.IsFirefox()&&(this.contentContainer.mozRequestFullScreen(this.contentContainer.ALLOW_KEYBOARD_INPUT),BX.bind(t,"mozfullscreenchange",this.fullscreenBind=BX.proxy(this.eventFullScreen,this)))},BX.PopupWindow.prototype.eventFullScreen=function(e){BX.PopupWindow.fullscreenStatus?(BX.browser.IsChrome()||BX.browser.IsSafari()?BX.unbind(t,"webkitfullscreenchange",this.fullscreenBind):BX.browser.IsFirefox()&&BX.unbind(t,"mozfullscreenchange",this.fullscreenBind),BX.removeClass(this.contentContainer,"popup-window-fullscreen",[this.contentContainer]),BX.PopupWindow.fullscreenStatus=!1,BX.onCustomEvent(this,"onPopupFullscreenLeave"),this.adjustPosition()):(BX.addClass(this.contentContainer,"popup-window-fullscreen"),BX.PopupWindow.fullscreenStatus=!0,BX.onCustomEvent(this,"onPopupFullscreenEnter",[this.contentContainer]),this.adjustPosition())},BX.PopupWindow.prototype.adjustPosition=function(t){t&&"object"==typeof t&&(this.bindOptions=t);var e=this.getBindElementPos(this.bindElement);if(this.bindOptions.forceBindPosition||null===this.bindElementPos||e.top!==this.bindElementPos.top||e.left!==this.bindElementPos.left){this.bindElementPos=e;var o=e.windowSize?e.windowSize:BX.GetWindowInnerSize(),i=e.windowScroll?e.windowScroll:BX.GetWindowScrollPos(),n=e.popupWidth?e.popupWidth:this.popupContainer.offsetWidth,s=e.popupHeight?e.popupHeight:this.popupContainer.offsetHeight,p=BX.PopupWindow.getOption("angleTopOffset"),u=this.bindElementPos.left+this.offsetLeft-(this.isTopOrBottomAngle()?BX.PopupWindow.getOption("angleLeftOffset"):0);if(!this.bindOptions.forceLeft&&u+n+this.bordersWidth>=o.innerWidth+i.scrollLeft&&o.innerWidth+i.scrollLeft-n-this.bordersWidth>0){var h=u;u=o.innerWidth+i.scrollLeft-n-this.bordersWidth,this.isTopOrBottomAngle()&&this.setAngle({offset:h-u+this.angle.defaultOffset})}else this.isTopOrBottomAngle()&&this.setAngle({offset:this.angle.defaultOffset+(u<0?u:0)});u<0&&(u=0);var a=0;this.bindOptions.position&&"top"===this.bindOptions.position?(a=this.bindElementPos.top-s-this.offsetTop-(this.isBottomAngle()?p:0))<0||!this.bindOptions.forceTop&&a<i.scrollTop?(a=this.bindElementPos.bottom+this.offsetTop,null!==this.angle&&(a+=p,this.setAngle({position:"top"}))):this.isTopAngle()?(a=a-p+BX.PopupWindow.getOption("positionTopXOffset"),this.setAngle({position:"bottom"})):a+=BX.PopupWindow.getOption("positionTopXOffset"):(a=this.bindElementPos.bottom+this.offsetTop+this.getAngleHeight(),!this.bindOptions.forceTop&&a+s>o.innerHeight+i.scrollTop&&this.bindElementPos.top-s-this.getAngleHeight()>=0?(a=this.bindElementPos.top-s,this.isTopOrBottomAngle()&&(a-=p,this.setAngle({position:"bottom"})),a+=BX.PopupWindow.getOption("positionTopXOffset")):this.isBottomAngle()&&(a+=p,this.setAngle({position:"top"}))),!this.parentPopup&&a<0&&(a=0),BX.adjust(this.popupContainer,{style:{top:a+"px",left:u+"px",zIndex:this.getZindex()}}),this.adjustOverlayZindex()}},BX.PopupWindow.prototype._onResizeWindow=function(t){this.isShown()&&(this.adjustPosition(),null!==this.overlay&&this.resizeOverlay())},BX.PopupWindow.prototype.move=function(t,e,o,i){var n=parseInt(this.popupContainer.style.left)+t,s=parseInt(this.popupContainer.style.top)+e;if("object"==typeof this.params.draggable&&this.params.draggable.restrict){!this.parentPopup&&n<0&&(n=0);var p=BX.GetWindowScrollSize(),u=this.popupContainer.offsetWidth,h=this.popupContainer.offsetHeight;n>p.scrollWidth-u&&(n=p.scrollWidth-u),s>p.scrollHeight-h&&(s=p.scrollHeight-h),!this.parentPopup&&s<0&&(s=0)}this.popupContainer.style.left=n+"px",this.popupContainer.style.top=s+"px"},BX.PopupWindow.prototype._startDrag=function(e,o){return e=e||t.event,BX.fixEventPageXY(e),o=o||{},BX.type.isNotEmptyString(o.cursor)&&(this.dragOptions.cursor=o.cursor),BX.type.isNotEmptyString(o.eventName)&&(this.dragOptions.eventName=o.eventName),BX.type.isFunction(o.callback)&&(this.dragOptions.callback=o.callback),this.dragPageX=e.pageX,this.dragPageY=e.pageY,this.dragged=!1,BX.bind(document,"mousemove",BX.proxy(this._moveDrag,this)),BX.bind(document,"mouseup",BX.proxy(this._stopDrag,this)),document.body.setCapture&&document.body.setCapture(),document.body.ondrag=BX.False,document.body.onselectstart=BX.False,document.body.style.cursor=this.dragOptions.cursor,document.body.style.MozUserSelect="none",this.popupContainer.style.MozUserSelect="none",BX.PreventDefault(e)},BX.PopupWindow.prototype._moveDrag=function(e){e=e||t.event,BX.fixEventPageXY(e),this.dragPageX===e.pageX&&this.dragPageY===e.pageY||(this.dragOptions.callback(e.pageX-this.dragPageX,e.pageY-this.dragPageY,e.pageX,e.pageY),this.dragPageX=e.pageX,this.dragPageY=e.pageY,this.dragged||(BX.onCustomEvent(this,"onPopup"+this.dragOptions.eventName+"Start",[this]),this.dragged=!0),BX.onCustomEvent(this,"onPopup"+this.dragOptions.eventName,[this]))},BX.PopupWindow.prototype._stopDrag=function(t){return document.body.releaseCapture&&document.body.releaseCapture(),BX.unbind(document,"mousemove",BX.proxy(this._moveDrag,this)),BX.unbind(document,"mouseup",BX.proxy(this._stopDrag,this)),document.body.ondrag=null,document.body.onselectstart=null,document.body.style.cursor="",document.body.style.MozUserSelect="",this.popupContainer.style.MozUserSelect="",BX.onCustomEvent(this,"onPopup"+this.dragOptions.eventName+"End",[this]),this.dragged=!1,BX.PreventDefault(t)},BX.PopupWindow.options={},BX.PopupWindow.defaultOptions={angleLeftOffset:40,positionTopXOffset:-11,angleTopOffset:10,popupZindex:1e3,popupOverlayZindex:1100,angleMinLeft:10,angleMaxLeft:10,angleMinRight:10,angleMaxRight:10,angleMinBottom:23,angleMaxBottom:25,angleMinTop:23,angleMaxTop:25,offsetLeft:0,offsetTop:0},BX.PopupWindow.setOptions=function(t){if(t&&"object"==typeof t)for(var e in t)BX.PopupWindow.options[e]=t[e]},BX.PopupWindow.getOption=function(t,e){return void 0!==BX.PopupWindow.options[t]?BX.PopupWindow.options[t]:void 0!==e?e:BX.PopupWindow.defaultOptions[t]},BX.PopupWindowButton=function(t){for(var e in this.popupWindow=null,this.params=t||{},this.text=this.params.text||"",this.id=this.params.id||"",this.className=this.params.className||"",this.events=this.params.events||{},this.contextEvents={},this.events)this.contextEvents[e]=BX.proxy(this.events[e],this);this.buttonNode=BX.create("span",{props:{className:"popup-window-button"+(this.className.length>0?" "+this.className:""),id:this.id},events:this.contextEvents,text:this.text})},BX.PopupWindowButton.prototype.render=function(){return this.buttonNode},BX.PopupWindowButton.prototype.getId=function(){return this.id},BX.PopupWindowButton.prototype.getName=function(){return this.name},BX.PopupWindowButton.prototype.getContainer=function(){return this.buttonNode},BX.PopupWindowButton.prototype.setName=function(t){this.text=t||"",this.buttonNode&&(BX.cleanNode(this.buttonNode),BX.adjust(this.buttonNode,{text:this.text}))},BX.PopupWindowButton.prototype.setClassName=function(t){this.buttonNode&&(BX.type.isString(this.className)&&""!==this.className&&BX.removeClass(this.buttonNode,this.className),BX.addClass(this.buttonNode,t)),this.className=t},BX.PopupWindowButton.prototype.addClassName=function(t){this.buttonNode&&(BX.addClass(this.buttonNode,t),this.className=this.buttonNode.className)},BX.PopupWindowButton.prototype.removeClassName=function(t){this.buttonNode&&(BX.removeClass(this.buttonNode,t),this.className=this.buttonNode.className)},BX.PopupWindowButtonLink=function(t){BX.PopupWindowButtonLink.superclass.constructor.apply(this,arguments),this.buttonNode=BX.create("span",{props:{className:"popup-window-button popup-window-button-link"+(this.className.length>0?" "+this.className:""),id:this.id},text:this.text,events:this.contextEvents})},BX.extend(BX.PopupWindowButtonLink,BX.PopupWindowButton),BX.PopupWindowCustomButton=function(t){BX.PopupWindowCustomButton.superclass.constructor.apply(this,arguments),this.buttonNode=BX.create("span",{props:{className:this.className.length>0?" "+this.className:"",id:this.id},events:this.contextEvents,text:this.text})},BX.extend(BX.PopupWindowCustomButton,BX.PopupWindowButton),BX.PopupMenu={Data:{},currentItem:null,show:function(t,e,o,i){null!==this.currentItem&&this.currentItem.popupWindow.close(),this.currentItem=this.create(t,e,o,i),this.currentItem.popupWindow.show()},create:function(t,e,o,i){return this.Data[t]||(this.Data[t]=new BX.PopupMenuWindow(t,e,o,i),BX.addCustomEvent(this.Data[t],"onPopupMenuDestroy",this.onPopupDestroy.bind(this))),this.Data[t]},getCurrentMenu:function(){return this.currentItem},getMenuById:function(t){return this.Data[t]?this.Data[t]:null},onPopupDestroy:function(t){this.destroy(t.id)},destroy:function(t){var e=this.getMenuById(t);e&&(this.currentItem===e&&(this.currentItem=null),e.popupWindow.destroy(),delete this.Data[t])}},BX.PopupMenuWindow=function(t,e,o,i){if(this.id=t,this.bindElement=e,this.menuItems=[],this.itemsContainer=null,this.params=i&&"object"==typeof i?i:{},this.parentMenuWindow=null,this.parentMenuItem=null,o&&BX.type.isArray(o))for(var n=0;n<o.length;n++)this.addMenuItemInternal(o[n],null);this.layout={menuContainer:null,itemsContainer:null},this.popupWindow=this.__createPopup()},BX.PopupMenuWindow.prototype.__createPopup=function(){for(var t=[],e=0;e<this.menuItems.length;e++){var o=this.menuItems[e].getLayout();t.push(o.item)}var i=new BX.PopupWindow("menu-popup-"+this.id,this.bindElement,{closeByEsc:void 0!==this.params.closeByEsc&&this.params.closeByEsc,bindOptions:"object"==typeof this.params.bindOptions?this.params.bindOptions:{},angle:void 0!==this.params.angle&&this.params.angle,zIndex:this.params.zIndex?this.params.zIndex:0,overlay:"object"==typeof this.params.overlay?this.params.overlay:null,autoHide:void 0===this.params.autoHide||this.params.autoHide,offsetTop:this.params.offsetTop?this.params.offsetTop:1,offsetLeft:this.params.offsetLeft?this.params.offsetLeft:0,className:BX.type.isNotEmptyString(this.params.className)?this.params.className:"",noAllPaddings:!0,content:this.layout.menuContainer=BX.create("div",{props:{className:"menu-popup"},children:[this.layout.itemsContainer=this.itemsContainer=BX.create("div",{props:{className:"menu-popup-items"},children:t})]}),events:{onPopupClose:this.onMenuWindowClose.bind(this),onPopupDestroy:this.onMenuWindowDestroy.bind(this)}});if(this.params&&this.params.events)for(var n in this.params.events)this.params.events.hasOwnProperty(n)&&BX.addCustomEvent(i,n,this.params.events[n]);return i},BX.PopupMenuWindow.prototype.getPopupWindow=function(){return this.popupWindow},BX.PopupMenuWindow.prototype.show=function(){this.popupWindow.show()},BX.PopupMenuWindow.prototype.close=function(){this.popupWindow.close()},BX.PopupMenuWindow.prototype.destroy=function(){BX.onCustomEvent(this,"onPopupMenuDestroy",[this]),this.popupWindow.destroy()},BX.PopupMenuWindow.prototype.onMenuWindowClose=function(){for(var t=0;t<this.menuItems.length;t++){this.menuItems[t].closeSubMenu()}},BX.PopupMenuWindow.prototype.onMenuWindowDestroy=function(){for(var t=0;t<this.menuItems.length;t++){this.menuItems[t].destroySubMenu()}},BX.PopupMenuWindow.prototype.setParentMenuWindow=function(t){t instanceof BX.PopupMenuWindow&&(this.parentMenuWindow=t)},BX.PopupMenuWindow.prototype.getParentMenuWindow=function(){return this.parentMenuWindow},BX.PopupMenuWindow.prototype.setParentMenuItem=function(t){t instanceof BX.PopupMenuItem&&(this.parentMenuItem=t)},BX.PopupMenuWindow.prototype.getParentMenuItem=function(){return this.parentMenuItem},BX.PopupMenuWindow.prototype.addMenuItem=function(t,e){var o=this.addMenuItemInternal(t,e);if(!o)return null;var i=o.getLayout(),n=this.getMenuItem(e);if(null!==n){var s=n.getLayout();this.itemsContainer.insertBefore(i.item,s.item)}else this.itemsContainer.appendChild(i.item);return o},BX.PopupMenuWindow.prototype.addMenuItemInternal=function(t,e){if(!t||!t.delimiter&&!BX.type.isNotEmptyString(t.text)||t.id&&null!==this.getMenuItem(t.id))return null;BX.type.isNumber(this.params.menuShowDelay)&&(t.menuShowDelay=this.params.menuShowDelay);var o=new BX.PopupMenuItem(t);o.setMenuWindow(this);var i=this.getMenuItemPosition(e);return i>=0?this.menuItems=BX.util.insertIntoArray(this.menuItems,i,o):this.menuItems.push(o),o},BX.PopupMenuWindow.prototype.removeMenuItem=function(t){var e=this.getMenuItem(t);if(e){for(var o=0;o<this.menuItems.length;o++)if(this.menuItems[o]===e){e.destroySubMenu(),this.menuItems=BX.util.deleteFromArray(this.menuItems,o);break}if(!this.menuItems.length){var i=e.getMenuWindow();if(i){var n=i.getParentMenuItem();n?n.destroySubMenu():i.destroy()}}e.layout.item.parentNode.removeChild(e.layout.item),e.layout={item:null,text:null}}},BX.PopupMenuWindow.prototype.getMenuItem=function(t){for(var e=0;e<this.menuItems.length;e++)if(this.menuItems[e].id&&this.menuItems[e].id===t)return this.menuItems[e];return null},BX.PopupMenuWindow.prototype.getMenuItems=function(){return this.menuItems},BX.PopupMenuWindow.prototype.getMenuItemPosition=function(t){if(t)for(var e=0;e<this.menuItems.length;e++)if(this.menuItems[e].id&&this.menuItems[e].id===t)return e;return-1},BX.PopupMenuItem=function(t){if(t=t||{},this.options=t,this.id=t.id||BX.util.getRandomString().toLowerCase(),this.text=BX.type.isNotEmptyString(t.text)?t.text:"",this.title=BX.type.isNotEmptyString(t.title)?t.title:"",this.delimiter=!0===t.delimiter,this.href=BX.type.isNotEmptyString(t.href)?t.href:null,this.target=BX.type.isNotEmptyString(t.target)?t.target:null,this.dataset=BX.type.isPlainObject(t.dataset)?t.dataset:null,this.className=BX.type.isNotEmptyString(t.className)?t.className:null,this.menuShowDelay=BX.type.isNumber(t.menuShowDelay)?t.menuShowDelay:300,this.subMenuOffsetX=BX.type.isNumber(t.subMenuOffsetX)?t.subMenuOffsetX:4,this._items=BX.type.isArray(t.items)?t.items:[],this.onclick=BX.type.isNotEmptyString(t.onclick)||BX.type.isFunction(t.onclick)?t.onclick:null,BX.type.isPlainObject(t.events))for(var e in t.events)BX.addCustomEvent(this,e,t.events[e]);for(var o in this.menuWindow=null,this.subMenuWindow=null,this.layout={item:null,text:null},this.getLayout(),this.events={},this.items=[],t)t.hasOwnProperty(o)&&void 0===this[o]&&(this[o]=t[o])},BX.PopupMenuItem.prototype={getLayout:function(){return this.layout.item||(this.delimiter?this.layout.item=BX.create("span",{props:{className:"popup-window-delimiter"}}):(this.layout.item=BX.create(this.href?"a":"span",{props:{className:["menu-popup-item",this.className?this.className:"menu-popup-no-icon",this.hasSubMenu()?"menu-popup-item-submenu":""].join(" ")},attrs:{title:this.title,onclick:BX.type.isString(this.onclick)?this.onclick:"",target:this.target?this.target:""},dataset:this.dataset,events:BX.type.isFunction(this.onclick)?{click:BX.delegate(this.onItemClick,this)}:null,children:[BX.create("span",{props:{className:"menu-popup-item-icon"}}),this.layout.text=BX.create("span",{props:{className:"menu-popup-item-text"},html:this.text})]}),this.href&&(this.layout.item.href=this.href),BX.bind(this.layout.item,"mouseenter",this.onItemMouseEnter.bind(this)),BX.bind(this.layout.item,"mouseleave",this.onItemMouseLeave.bind(this)))),this.layout},onItemClick:function(t){this.onclick.call(this.menuWindow,t,this)},onItemMouseEnter:function(t){BX.onCustomEvent(this,"onMouseEnter"),this.subMenuTimeout&&clearTimeout(this.subMenuTimeout),this.hasSubMenu()?this.subMenuTimeout=setTimeout(function(){this.showSubMenu()}.bind(this),this.menuShowDelay):this.subMenuTimeout=setTimeout(function(){this.closeSiblings()}.bind(this),this.menuShowDelay)},onItemMouseLeave:function(t){BX.onCustomEvent(this,"onMouseLeave"),this.subMenuTimeout&&clearTimeout(this.subMenuTimeout)},hasSubMenu:function(){return null!==this.subMenuWindow||this._items.length},showSubMenu:function(){if(this.addSubMenu(this._items),this.subMenuWindow){BX.addClass(this.layout.item,"menu-popup-item-open"),this.closeSiblings(),this.closeChildren();var t=this.subMenuWindow.getPopupWindow();t.isShown()||(BX.onCustomEvent(this,"onSubMenuShow"),t.show()),this.adjustSubMenu()}},addSubMenu:function(t){null===this.subMenuWindow&&BX.type.isArray(t)&&t.length&&(this.subMenuWindow=new BX.PopupMenuWindow("popup-submenu-"+this.id,null,t,{autoHide:!1,menuShowDelay:this.menuShowDelay,bindOptions:{forceTop:!0,forceLeft:!0,forceBindPosition:!0}}),this.subMenuWindow.setParentMenuWindow(this.menuWindow),this.subMenuWindow.setParentMenuItem(this),BX.addClass(this.layout.item,"menu-popup-item-submenu"))},closeSubMenu:function(){if(this.subMenuWindow){BX.removeClass(this.layout.item,"menu-popup-item-open"),this.closeChildren();var t=this.subMenuWindow.getPopupWindow();t.isShown()&&(BX.onCustomEvent(this,"onSubMenuClose"),t.close()),this.subMenuWindow.close()}},closeSiblings:function(){for(var t=this.menuWindow.getMenuItems(),e=0;e<t.length;e++)t[e]!==this&&t[e].closeSubMenu()},closeChildren:function(){if(this.subMenuWindow)for(var t=this.subMenuWindow.getMenuItems(),e=0;e<t.length;e++)t[e].closeSubMenu()},destroySubMenu:function(){this.subMenuWindow&&(BX.removeClass(this.layout.item,"menu-popup-item-open menu-popup-item-submenu"),this.destroyChildren(),this.subMenuWindow.destroy(),this.subMenuWindow=null,this._items=[])},destroyChildren:function(){if(this.subMenuWindow)for(var t=this.subMenuWindow.getMenuItems(),e=0;e<t.length;e++)t[e].destroySubMenu()},adjustSubMenu:function(){if(this.subMenuWindow&&this.layout.item){var t=this.subMenuWindow.getPopupWindow(),e=BX.pos(this.layout.item),o=e.width+this.subMenuOffsetX,i="left",n=t.popupContainer.offsetWidth,s=document.documentElement.clientWidth;if(e.left+o+n>s)e.left-n-this.subMenuOffsetX>0&&(o=-n-this.subMenuOffsetX,i="right");t.setBindElement(this.layout.item),t.setOffset({offsetLeft:o,offsetTop:-(e.height+this.getPopupPadding())}),t.setAngle({position:i,offset:e.height/2-this.getPopupPadding()}),t.adjustPosition()}},getPopupPadding:function(){if(!BX.type.isNumber(this.popupPadding))if(this.subMenuWindow){var t=this.subMenuWindow.layout.menuContainer;this.popupPadding=parseInt(BX.style(t,"paddingTop"),10)}else this.popupPadding=0;return this.popupPadding},getSubMenu:function(){return this.subMenuWindow},getId:function(){return this.id},setMenuWindow:function(t){this.menuWindow=t},getMenuWindow:function(){return this.menuWindow},getMenuShowDelay:function(){return this.menuShowDelay}},t.BXInputPopup=function(t){this.id=t.id||"bx-inp-popup-"+Math.round(1e6*Math.random()),this.handler=t.handler||!1,this.values=t.values||!1,this.pInput=t.input,this.bValues=!!this.values,this.defaultValue=t.defaultValue||"",this.openTitle=t.openTitle||"",this.className=t.className||"",this.noMRclassName=t.noMRclassName||"ec-no-rm",this.emptyClassName=t.noMRclassName||"ec-label";var e=this;this.curInd=!1,this.bValues?(this.pInput.onfocus=this.pInput.onclick=function(t){return this.value==e.defaultValue&&(this.value="",this.className=e.className),e.ShowPopup(),BX.PreventDefault(t)},this.pInput.onblur=function(){e.bShowed&&setTimeout((function(){e.ClosePopup(!0)}),200),e.OnChange()}):(this.pInput.className=this.noMRclassName,this.pInput.onblur=BX.proxy(this.OnChange,this))},BXInputPopup.prototype={ShowPopup:function(){if(!this.bShowed){var t=this;if(!this.oPopup){for(var e,o=BX.create("DIV",{props:{className:"bxecpl-loc-popup "+this.className}}),i=0,n=this.values.length;i<n;i++)e=o.appendChild(BX.create("DIV",{props:{id:"bxecmr_"+i},text:this.values[i].NAME,events:{mouseover:function(){BX.addClass(this,"bxecplloc-over")},mouseout:function(){BX.removeClass(this,"bxecplloc-over")},click:function(){var e=this.id.substr("bxecmr_".length);t.pInput.value=t.values[e].NAME,t.curInd=e,t.OnChange(),t.ClosePopup(!0)}}})),this.values[i].DESCRIPTION&&(e.title=this.values[i].DESCRIPTION),this.values[i].CLASS_NAME&&BX.addClass(e,this.values[i].CLASS_NAME),this.values[i].URL&&e.appendChild(BX.create("A",{props:{href:this.values[i].URL,className:"bxecplloc-view",target:"_blank",title:this.openTitle}}));this.oPopup=new BX.PopupWindow(this.id,this.pInput,{autoHide:!0,offsetTop:1,offsetLeft:0,lightShadow:!0,closeByEsc:!0,content:o}),BX.addCustomEvent(this.oPopup,"onPopupClose",BX.proxy(this.ClosePopup,this))}this.oPopup.show(),this.pInput.select(),this.bShowed=!0,BX.onCustomEvent(this,"onInputPopupShow",[this])}},ClosePopup:function(t){this.bShowed=!1,""==this.pInput.value&&this.OnChange(),BX.onCustomEvent(this,"onInputPopupClose",[this]),!0===t&&this.oPopup.close()},OnChange:function(){var t=this.pInput.value;this.bValues&&(""==this.pInput.value||this.pInput.value==this.defaultValue?(this.pInput.value=this.defaultValue,this.pInput.className=this.emptyClassName,t=""):this.pInput.className=""),isNaN(parseInt(this.curInd))||!1!==this.curInd&&t!=this.values[this.curInd].NAME?this.curInd=!1:this.curInd=parseInt(this.curInd),BX.onCustomEvent(this,"onInputPopupChanged",[this,this.curInd,t]),this.handler&&"function"==typeof this.handler&&this.handler({ind:this.curInd,value:t})},Set:function(t,e,o){this.curInd=t,!1!==this.curInd?this.pInput.value=this.values[this.curInd].NAME:this.pInput.value=e,!1!==o&&this.OnChange()},Get:function(t){var e=!1;return void 0===t&&(t=this.curInd),!1!==t&&this.values[t]&&(e=this.values[t].ID),e},GetIndex:function(t){for(var e=0,o=this.values.length;e<o;e++)if(this.values[e].ID==t)return e;return!1},Deactivate:function(t){""!=this.pInput.value&&this.pInput.value!=this.defaultValue||(t?(this.pInput.value="",this.pInput.className=this.noMRclassName):this.oEC.bUseMR&&(this.pInput.value=this.defaultValue,this.pInput.className=this.emptyClassName)),this.pInput.disabled=t}};var e=-1,o=null}function i(t,n){if(!1===t){if(o&&o.length>0){for(var s=0;s<o.length;s++)o[s]();o=null,e=-1}}else null===o&&(o=[],e=-1,BX.defer(i)(!1)),t>e?(e=t,o=[n]):t==e&&o.push(n)}}(window);